(()=>{"use strict";const e=!0?()=>{}:console.log;const t=(e=>e?()=>{}:console.error)(!0),a={logTime:e=>()=>{},logInfo:e,logError:t,LogLastError:({lastError:e}=chrome.runtime)=>e?t(e):null},r=()=>new Promise(((e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},(([t])=>{a.logInfo(t),e(t)}))})),s=r,n=async e=>{const t=e??await r();return new Promise(((e,a)=>{chrome.tabs.sendMessage(t.id,{type:"getOrigin"},(({data:t})=>{const a=chrome.runtime?.lastError;if(a)throw a;e(t)}))}))};const o={storePrefs:function(e,t){try{const a=`preferences_${e}`,r=JSON.stringify(t);return localStorage.setItem(a,r),{success:!0}}catch(e){return{success:!1,error:e}}},retrievePrefs:function(e){const t=`preferences_${e}`,a=localStorage.getItem(t);try{return{data:JSON.parse(a)}}catch(e){return{data:null,error:e}}}},c={onPageLoad:!1,scope:"global",lineHeight:1,edgeOpacity:70,saccadesColor:"",saccadesStyle:"bold-600",saccadesInterval:0,fixationStrength:2,fixationEdgeOpacity:80,MAX_FIXATION_PARTS:4,FIXATION_LOWER_BOUND:0,BR_WORD_STEM_PERCENTAGE:.7},i=[],d=[];let g;const l=()=>"function"==typeof chrome?.extension?.getBackgroundPage&&chrome.extension.getBackgroundPage()===window;async function f(e){return new Promise(((t,a)=>{if(l()){const a=o.retrievePrefs(e);t(a?.data)}else chrome.runtime.sendMessage({message:"retrievePrefs",action:e},(async e=>{t(e?.data)}))}))}function u(e,t){return new Promise(((a,r)=>{l()?(o.storePrefs(t,e),a(!0)):chrome.runtime.sendMessage({message:"storePrefs",data:e,action:t},(async e=>{a(!0)}))}))}async function m(){return f("local")}async function h(){return f("global")}async function y(e){return u(e,"local")}async function p(e){return u(e,"global")}async function b(){return{...(await m())[await g()]??await h()}}async function w(e){const t=await m();let a=await h();const r=await g(),s={..."local"===t[r]?.scope?t[r]:a},n={...s,..."function"==typeof e?e(s):e};"global"===n.scope?(a={...a,...t[r]?null:n,scope:n.scope},t[r]&&delete t[r]):t[r]={...t[r],...n},E(t[r]??a),y(t),p(a)}async function P(){let e=await m(),t=await h();const a=await g();null==e&&(e={}),t={...c,...t},y(e),p(t),"local"===e[a]?.scope?(E(e[a]),E(e[a],d)):(E(t),E(t,d))}function E(e,t){Array.isArray(t)?t.forEach((t=>{t(e)})):i.forEach((t=>{t(e)}))}const I={init:function(e){return e.subscribe&&i.push(e.subscribe),e.onStartup&&d.push(e.onStartup),g=e.getOrigin,{start:P,setPrefs:w,getPrefs:b,defaultPrefs:()=>c}}},L="undefined"==typeof browser?chrome:browser,{getPrefs:O,defaultPrefs:M}=I.init({getOrigin:async()=>n()});chrome.runtime.onInstalled.addListener((e=>{a.logInfo("install success",e.reason),e.reason,chrome.tabs.create({active:!0,url:"https://github.com/ansh/jiffyreader.com#FAQ"})})),chrome.commands.onCommand.addListener((async e=>{if(a.logInfo("commmand fired",e),"toggle-bionic"===e){const e=await s(),[{data:t},r]=await new Promise(((t,r)=>{chrome.tabs.sendMessage(e.id,{type:"getReadingMode"},(r=>{a.logInfo({activeTab:e,response:r}),t([r,chrome.runtime?.lastError])}))}));if(r)throw a.logError(r);const n=await O(),o=!t;chrome.tabs.sendMessage(e.id,{type:"setReadingMode",data:o},(()=>a.LogLastError())),o&&(a.logInfo(n),chrome.tabs.sendMessage(e.id,{type:"setSaccadesIntervalInDOM",data:n.saccadesInterval},(()=>a.LogLastError())),chrome.tabs.sendMessage(e.id,{type:"setLineHeight",data:n.lineHeight}),chrome.tabs.sendMessage(e.id,{type:"setFixationStrength",data:n.fixationStrength},(()=>a.LogLastError())),chrome.tabs.sendMessage(e.id,{type:"setFixationEdgeOpacity",data:n.fixationEdgeOpacity},(()=>a.LogLastError())),chrome.tabs.sendMessage(e.id,{type:"setSaccadesStyle",data:n.saccadesStyle},(()=>a.LogLastError())))}})),L.runtime.onMessage.addListener(((e,t,a)=>{switch(e.message){case"storePrefs":a(o.storePrefs(e.action,e.data));break;case"retrievePrefs":a(o.retrievePrefs(e.action));break;case"setIconBadgeText":s().then((t=>{chrome.browserAction.setBadgeText({text:e.data?"On":"Off",tabId:t.id}),a(!0)}));break;default:a(!1)}}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianMvYmFja2dyb3VuZC5idW5kbGUuanMiLCJtYXBwaW5ncyI6Im1CQU1BLE1BcUJNQSxHQXJCd0JDLEVBSXFCLE9BQVdDLFFBQVFDLElBa0J0RSxNQUFNQyxFQXBCYUMsQ0FBQUEsR0FBa0JBLEVBQWUsT0FBV0gsUUFBUUksTUFvQnREQyxFQXRCYU4sR0ErQjlCLEVBUGUsQ0FDYk8sUUFkZUMsR0FFTixPQWFUVCxRQUFBQSxFQUNBSSxTQUFBQSxFQUNBTSxhQUxtQixFQUFHQyxVQUFBQSxHQUFjQyxPQUFPQyxVQUFhRixFQUFZUCxFQUFTTyxHQUFhLE1DMUJ0RkcsRUFBZSxJQUFNLElBQUlDLFNBQVEsQ0FBQ0MsRUFBS0MsS0FDM0NMLE9BQU9NLEtBQUtDLE1BQU0sQ0FBRUMsUUFBUSxFQUFNQyxlQUFlLElBQVEsRUFBRUMsTUFDekRDLEVBQUFBLFFBQWVELEdBQ2ZOLEVBQUlNLFNBeUJSLEVBQWlCUixFQUFqQixFQWhCcUJVLE1BQUFBLElBQ25CLE1BQU1DLEVBQVVDLFNBQWNaLElBQzlCLE9BQU8sSUFBSUMsU0FBUSxDQUFDQyxFQUFLQyxLQUN2QkwsT0FBT00sS0FBS1MsWUFDVkYsRUFBUUcsR0FDUixDQUFFQyxLQUFNLGNBQ1IsRUFBaUNDLEtBQUFBLE1BQy9CLE1BQU1DLEVBQWNuQixPQUFPQyxTQUFTRixVQUNwQyxHQUFJb0IsRUFBYSxNQUFNQSxFQUV2QmYsRUFBSWMsVUNGWixTQUNFRSxXQXhCRixTQUFvQkMsRUFBUUgsR0FDMUIsSUFDRSxNQUFNSSxFQUFPLGVBQWNELElBQ3JCRSxFQUFlQyxLQUFLQyxVQUFVUCxHQUVwQyxPQURBUSxhQUFhQyxRQUFRTCxFQUFLQyxHQUNuQixDQUFFSyxTQUFTLEdBQ2xCLE1BQU9DLEdBQ1AsTUFBTyxDQUFFRCxTQUFTLEVBQU9sQyxNQUFPbUMsS0FrQmxDQyxjQWRGLFNBQThEVCxHQUM1RCxNQUFNQyxFQUFPLGVBQWNELElBQ3JCRSxFQUFlRyxhQUFhSyxRQUFRVCxHQUMxQyxJQUdFLE1BQU8sQ0FBRUosS0FES00sS0FBS1EsTUFBTVQsSUFFekIsTUFBT00sR0FDUCxNQUFPLENBQUVYLEtBQU0sS0FBTXhCLE1BQU9tQyxNQ1puQkksRUFBZSxDQUMxQkMsWUFBWSxFQUNaQyxNQUFPLFNBQ1BDLFdBQVksRUFDWkMsWUFBYSxHQUNiQyxjQUFlLEdBQ2ZDLGNBQWUsV0FDZkMsaUJBQWtCLEVBQ2xCQyxpQkFBa0IsRUFDbEJDLG9CQUFxQixHQUNyQkMsbUJBQW9CLEVBQ3BCQyxxQkFBc0IsRUFDdEJDLHdCQUF5QixJQVFyQkMsRUFBc0IsR0FNdEJDLEVBQXFCLEdBWTNCLElBQUlDLEVBaURKLE1BQU1DLEVBQXFCLElBQzJCLG1CQUF6Q2pELFFBQVFrRCxXQUFXQyxtQkFPckJuRCxPQUFPa0QsVUFBVUMsc0JBQXdCQyxPQU1wRHhDLGVBQWV5QyxFQUFnRWhDLEdBQzdFLE9BQU8sSUFBSWxCLFNBQVEsQ0FBQ21ELEVBQVNDLEtBQzNCLEdBQUlOLElBQXNCLENBQ3hCLE1BQU1PLEVBQVdDLEVBQWMzQixjQUFjVCxHQUM3Q2lDLEVBQVFFLEdBQVV0QyxXQUVsQmxCLE9BQU9DLFFBQVFjLFlBQVksQ0FBRTJDLFFBQVMsZ0JBQWlCckMsT0FBQUEsSUFBVVQsTUFBQUEsSUFDL0QwQyxFQUFRRSxHQUFVdEMsWUFNMUIsU0FBU3lDLEVBQ2NDLEVBQ2tCdkMsR0FFdkMsT0FBTyxJQUFJbEIsU0FBUSxDQUFDbUQsRUFBU0MsS0FDdkJOLEtBQ0ZRLEVBQWNyQyxXQUFXQyxFQUFRdUMsR0FDakNOLEdBQVEsSUFFUnRELE9BQU9DLFFBQVFjLFlBQVksQ0FBRTJDLFFBQVMsYUFBY3hDLEtBQU0wQyxFQUFPdkMsT0FBQUEsSUFBVVQsTUFBQUEsSUFDekUwQyxHQUFRLFNBT2hCMUMsZUFBZWlELElBQ2IsT0FBT1IsRUFBeUIsU0FJbEN6QyxlQUFla0QsSUFDYixPQUFPVCxFQUF5QixVQUlsQ3pDLGVBQWVtRCxFQUFnQkgsR0FDN0IsT0FBT0QsRUFBb0JDLEVBQU8sU0FHcENoRCxlQUFlb0QsRUFBaUJKLEdBQzlCLE9BQU9ELEVBQW9CQyxFQUFPLFVBT3BDaEQsZUFBZXFELElBQ2IsTUFBTyxXQUFhSixXQUE0QmIsWUFBdUJjLEtBWXpFbEQsZUFBZXNELEVBQWdETixHQUU3RCxNQUFNTyxRQUFtQk4sSUFDekIsSUFBSU8sUUFBb0JOLElBQ3hCLE1BQU1PLFFBQWVyQixJQUdmc0IsRUFBZSxJQUNlLFVBQTlCSCxFQUFXRSxJQUFTbEMsTUFBb0JnQyxFQUFXRSxHQUFVRCxHQVE3REcsRUFBVyxJQUNaRCxLQUNrQixtQkFBVlYsRUFBdUJBLEVBQU1VLEdBQWdCVixHQUduQyxXQUFuQlcsRUFBU3BDLE9BRVhpQyxFQUFjLElBQ1RBLEtBRUVELEVBQVdFLEdBQXFCLEtBQVhFLEVBQzFCcEMsTUFBT29DLEVBQVNwQyxPQUdkZ0MsRUFBV0UsV0FBZ0JGLEVBQVdFLElBRTFDRixFQUFXRSxHQUFVLElBQUtGLEVBQVdFLE1BQVlFLEdBR25EQyxFQUFvQkwsRUFBV0UsSUFBV0QsR0FFMUNMLEVBQWdCSSxHQUNoQkgsRUFBaUJJLEdBU25CeEQsZUFBZTZELElBQ2IsSUFBSU4sUUFBbUJOLElBQ25CTyxRQUFvQk4sSUFDeEIsTUFBTU8sUUFBZXJCLElBRUgsTUFBZG1CLElBQ0ZBLEVBQWEsSUFNZkMsRUFBYyxJQUFLbkMsS0FBaUJtQyxHQUVwQ0wsRUFBZ0JJLEdBQ2hCSCxFQUFpQkksR0FFaUIsVUFBOUJELEVBQVdFLElBQVNsQyxPQUN0QnFDLEVBQW9CTCxFQUFXRSxJQUMvQkcsRUFBb0JMLEVBQVdFLEdBQVN0QixLQUV4Q3lCLEVBQW9CSixHQUNwQkksRUFBb0JKLEVBQWFyQixJQVNyQyxTQUFTeUIsRUFBdUNaLEVBQWlDYyxHQUMzRUMsTUFBTUMsUUFBUUYsR0FDaEJBLEVBQUlHLFNBQVNDLElBQ1hBLEVBQUdsQixNQUdMZCxFQUFvQitCLFNBQVNDLElBQzNCQSxFQUFHbEIsTUFLVCxTQUNFbUIsS0FqTUYsU0FBY0MsR0FlWixPQVZJQSxFQUFPQyxXQUNUbkMsRUFBb0JvQyxLQUFLRixFQUFPQyxXQUU5QkQsRUFBT0csV0FDVHBDLEVBQW1CbUMsS0FBS0YsRUFBT0csV0FJakNuQyxFQUFZZ0MsRUFBT2hDLFVBRVosQ0FDTHlCLE1BQUFBLEVBQ0FQLFNBQUFBLEVBQ0FELFNBQUFBLEVBQ0FoQyxhQUFjLElBQU1BLEtDckZsQm1ELEVBQW9DLG9CQUFaQyxRQUEwQnJGLE9BQVNxRixTQUV6RHBCLFNBQUYsRUFBWWhDLGFBQVlBLEdBQUtxRCxFQUFZUCxLQUFLLENBQ2xEL0IsVUFBV3BDLFNBQVkyRSxNQXVGekJ2RixPQUFPQyxRQUFRdUYsWUFBWUMsYUFDeEJDLElBQ0MvRSxFQUFBQSxRQUFlLGtCQUFtQitFLEVBQU1DLFFBRXBDRCxFQUFNQyxPQUFpRTNGLE9BQU9NLEtBQUtzRixPQUFPLENBQUVwRixRQUFRLEVBQU1xRixJQUFLLG1EQUl2SDdGLE9BQU84RixTQUFTQyxVQUFVTixhQXJFRjdFLE1BQUFBLElBR3RCLEdBRkFELEVBQUFBLFFBQWUsaUJBQWtCcUYsR0FFakIsa0JBQVpBLEVBQTZCLENBQy9CLE1BQU10RixRQUFrQjZFLE1BRWZyRSxLQUFNK0UsR0FBYUMsU0FBNkIsSUFBSS9GLFNBQVEsQ0FBQ0MsRUFBS0MsS0FDekVMLE9BQU9NLEtBQUtTLFlBQVlMLEVBQVVNLEdBQUksQ0FBRUMsS0FBTSxtQkFBcUJ1QyxJQUNqRTdDLEVBQUFBLFFBQWUsQ0FBRUQsVUFBQUEsRUFBVzhDLFNBQUFBLElBQzVCcEQsRUFBSSxDQUFDb0QsRUFBVXhELE9BQU9DLFNBQVNGLGtCQUluQyxHQUFJbUcsRUFBcUIsTUFBTXZGLEVBQUFBLFNBQWdCdUYsR0FHL0MsTUFBTXRDLFFBQWNLLElBRWRrQyxHQUFxQkYsRUFDM0JqRyxPQUFPTSxLQUFLUyxZQUFZTCxFQUFVTSxHQUFJLENBQUVDLEtBQU0saUJBQWtCQyxLQUFNaUYsSUFBcUIsSUFBTXhGLEVBQUFBLGlCQUU3RndGLElBQ0Z4RixFQUFBQSxRQUFlaUQsR0FFZjVELE9BQU9NLEtBQUtTLFlBQ1ZMLEVBQVVNLEdBQ1YsQ0FDRUMsS0FBTSwyQkFDTkMsS0FBTTBDLEVBQU1wQixtQkFFZCxJQUFNN0IsRUFBQUEsaUJBRVJYLE9BQU9NLEtBQUtTLFlBQVlMLEVBQVVNLEdBQUksQ0FBRUMsS0FBTSxnQkFBaUJDLEtBQU0wQyxFQUFNeEIsYUFDM0VwQyxPQUFPTSxLQUFLUyxZQUNWTCxFQUFVTSxHQUNWLENBQ0VDLEtBQU0sc0JBQ05DLEtBQU0wQyxFQUFNbkIsbUJBRWQsSUFBTTlCLEVBQUFBLGlCQUVSWCxPQUFPTSxLQUFLUyxZQUNWTCxFQUFVTSxHQUNWLENBQ0VDLEtBQU0seUJBQ05DLEtBQU0wQyxFQUFNbEIsc0JBRWQsSUFBTS9CLEVBQUFBLGlCQUVSWCxPQUFPTSxLQUFLUyxZQUNWTCxFQUFVTSxHQUNWLENBQ0VDLEtBQU0sbUJBQ05DLEtBQU0wQyxFQUFNckIsZ0JBRWQsSUFBTTVCLEVBQUFBLHNCQWdCZHlFLEVBQWVuRixRQUFRbUcsVUFBVVgsYUE5RmhCLENBQUNZLEVBQVNDLEVBQVFDLEtBQ2pDLE9BQVFGLEVBQVEzQyxTQUNkLElBQUssYUFDSDZDLEVBQWE5QyxFQUFjckMsV0FBV2lGLEVBQVFoRixPQUFRZ0YsRUFBUW5GLE9BQzlELE1BRUYsSUFBSyxnQkFDSHFGLEVBQWE5QyxFQUFjM0IsY0FBY3VFLEVBQVFoRixTQUNqRCxNQUVGLElBQUssbUJBQ0hrRSxJQUF5QmlCLE1BQU0xRixJQUM3QmQsT0FBT3lHLGNBQWNDLGFBQWEsQ0FBRUMsS0FBTU4sRUFBUW5GLEtBQU8sS0FBTyxNQUFPMEYsTUFBTzlGLEVBQUlFLEtBQ2xGdUYsR0FBYSxNQUVmLE1BRUYsUUFDRUEsR0FBYSxRIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL0xvZ2dlci5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvVGFiSGVscGVyLmpzIiwid2VicGFjazovLy8uL3NyYy9TdG9yYWdlSGVscGVyLmpzIiwid2VicGFjazovLy8uL3NyYy9QcmVmZXJlbmNlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvQmFja2dyb3VuZC9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqXG4gKiBwcm92aWRlIGRldmVsb3BtZW50IHV0aWxpdHkgZnVuY3Rpb25zIGZvciByZXBvcnRpbmcgZXJyb3JzLCBsb2dnaW5nIGRhdGEgYW5kIGxvZ2dpbmcgdGltZVxuICovXG5cbi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cbmNvbnN0IGlzUHJvZHVjdGlvbkVudiA9ICgpID0+IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbic7XG5cbmNvbnN0IG1ha2VFcnJvciA9IChpc1Byb2R1Y3Rpb24pID0+IChpc1Byb2R1Y3Rpb24gPyAoKSA9PiB7fSA6IGNvbnNvbGUuZXJyb3IpO1xuXG5jb25zdCBtYWtlSW5mbyA9IChpc1Byb2R1Y3Rpb24pID0+IChpc1Byb2R1Y3Rpb24gPyAoKSA9PiB7fSA6IGNvbnNvbGUubG9nKTtcblxuLyoqXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IGxhYmVsXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IGVuZCBhbmQgZGlzcGxheSB0aW1lIHdoZW4gY2FsbGVkIGluIG5vbiBwcm9kdWN0aW9uIGVudmlyb25tZW50XG4gKi9cbmNvbnN0IGxvZ1RpbWUgPSAobGFiZWwpID0+IHtcbiAgaWYgKGlzUHJvZHVjdGlvbkVudigpKSB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIC8vIG5vLW9wfVxuICAgIH07XG4gIH1cbiAgY29uc29sZS50aW1lKGxhYmVsKTtcbiAgcmV0dXJuICgpID0+IGNvbnNvbGUudGltZUVuZChsYWJlbCk7XG59O1xuXG5jb25zdCBsb2dJbmZvID0gbWFrZUluZm8oaXNQcm9kdWN0aW9uRW52KCkpO1xuY29uc3QgbG9nRXJyb3IgPSBtYWtlRXJyb3IoaXNQcm9kdWN0aW9uRW52KCkpO1xuY29uc3QgTG9nTGFzdEVycm9yID0gKHsgbGFzdEVycm9yIH0gPSBjaHJvbWUucnVudGltZSkgPT4gKGxhc3RFcnJvciA/IGxvZ0Vycm9yKGxhc3RFcnJvcikgOiBudWxsKTtcbmNvbnN0IExvZ2dlciA9IHtcbiAgbG9nVGltZSxcbiAgbG9nSW5mbyxcbiAgbG9nRXJyb3IsXG4gIExvZ0xhc3RFcnJvcixcbn07XG5cbmV4cG9ydCBkZWZhdWx0IExvZ2dlcjtcbiIsImltcG9ydCBMb2dnZXIgZnJvbSAnLi9Mb2dnZXInO1xuXG4vKiogQHJldHVybnMge1Byb21pc2U8Y2hyb21lLnRhYnMuVGFiPn0gKi9cbmNvbnN0IGdldEFjdGl2ZVRhYiA9ICgpID0+IG5ldyBQcm9taXNlKChyZXMsIF8pID0+IHtcbiAgY2hyb21lLnRhYnMucXVlcnkoeyBhY3RpdmU6IHRydWUsIGN1cnJlbnRXaW5kb3c6IHRydWUgfSwgKFthY3RpdmVUYWJdKSA9PiB7XG4gICAgTG9nZ2VyLmxvZ0luZm8oYWN0aXZlVGFiKTtcbiAgICByZXMoYWN0aXZlVGFiKTtcbiAgfSk7XG59KTtcblxuLyoqXG4gKiBAcGFyYW1zIHtjaHJvbWUudGFicy5UYWJ9IFt0YWIgPSBnZXRBY3RpdmVUYWIoKV1cbiAqIEByZXR1cm5zIHtQcm9taXNlPHN0cmluZz59IC1cbiAqIHRoZSBvcmlnaW4gb2YgdGhlIHRhYiBwcm92aWRlZCBvciB0aGUgb3JpZ2luIG9mIHRoZSBhY3RpdmUgdGFiIGlmIHRhYiBpcyBudWxsXG4gKi9cbmNvbnN0IGdldFRhYk9yaWdpbiA9IGFzeW5jICh0YWIpID0+IHtcbiAgY29uc3QgdGVtcFRhYiA9IHRhYiA/PyAoYXdhaXQgZ2V0QWN0aXZlVGFiKCkpO1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlcywgXykgPT4ge1xuICAgIGNocm9tZS50YWJzLnNlbmRNZXNzYWdlKFxuICAgICAgdGVtcFRhYi5pZCxcbiAgICAgIHsgdHlwZTogJ2dldE9yaWdpbicgfSxcbiAgICAgICgvKiogQHR5cGUge3tkYXRhOiBzdHJpbmd9fSAqLyB7IGRhdGEgfSkgPT4ge1xuICAgICAgICBjb25zdCBvcmlnaW5FcnJvciA9IGNocm9tZS5ydW50aW1lPy5sYXN0RXJyb3I7XG4gICAgICAgIGlmIChvcmlnaW5FcnJvcikgdGhyb3cgb3JpZ2luRXJyb3I7XG5cbiAgICAgICAgcmVzKGRhdGEpO1xuICAgICAgfSxcbiAgICApO1xuICB9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHsgZ2V0QWN0aXZlVGFiLCBnZXRUYWJPcmlnaW4gfTtcbiIsImZ1bmN0aW9uIHN0b3JlUHJlZnMoYWN0aW9uLCBkYXRhKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qga2V5ID0gYHByZWZlcmVuY2VzXyR7YWN0aW9ufWA7XG4gICAgY29uc3QgcHJlZnNKU09OU3RyID0gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBwcmVmc0pTT05TdHIpO1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnIgfTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZXRyaWV2ZVByZWZzKC8qKiBAdHlwZSB7c3RyaW5nfSAnbG9jYWwnfCdnbG9iYWwnICovIGFjdGlvbikge1xuICBjb25zdCBrZXkgPSBgcHJlZmVyZW5jZXNfJHthY3Rpb259YDtcbiAgY29uc3QgcHJlZnNKU09OU3RyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgdHJ5IHtcbiAgICAvKiogQHR5cGUge1Byb21pc2U8UHJlZnNbXT58UHJvbWlzZTxQcmVmcz59ICovXG4gICAgY29uc3QgcHJlZnMgPSBKU09OLnBhcnNlKHByZWZzSlNPTlN0cik7XG4gICAgcmV0dXJuIHsgZGF0YTogcHJlZnMgfTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgcmV0dXJuIHsgZGF0YTogbnVsbCwgZXJyb3I6IGVyciB9O1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgc3RvcmVQcmVmcyxcbiAgcmV0cmlldmVQcmVmcyxcbn07XG4iLCJpbXBvcnQgU3RvcmFnZUhlbHBlciBmcm9tICcuLi9TdG9yYWdlSGVscGVyJztcbi8vIGRlZmF1bHQgcHJlZmVyZW5jZXNcbi8vIGFuZCBzb3VyY2Ugb2YgdHJ1dGhcbi8vIGZvciBib3RoIGdsb2JhbCBhbmQgbG9jYWwgcHJlZnNcbi8vIHNvIG5ldyBwcmVmZXJlbmNlcyBzaG91bGQgYmVcbi8vIGFkZGVkIGhlcmVcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRQcmVmcyA9IHtcbiAgb25QYWdlTG9hZDogZmFsc2UsXG4gIHNjb3BlOiAnZ2xvYmFsJyxcbiAgbGluZUhlaWdodDogMSxcbiAgZWRnZU9wYWNpdHk6IDcwLFxuICBzYWNjYWRlc0NvbG9yOiAnJyxcbiAgc2FjY2FkZXNTdHlsZTogJ2JvbGQtNjAwJyxcbiAgc2FjY2FkZXNJbnRlcnZhbDogMCxcbiAgZml4YXRpb25TdHJlbmd0aDogMixcbiAgZml4YXRpb25FZGdlT3BhY2l0eTogODAsXG4gIE1BWF9GSVhBVElPTl9QQVJUUzogNCxcbiAgRklYQVRJT05fTE9XRVJfQk9VTkQ6IDAsXG4gIEJSX1dPUkRfU1RFTV9QRVJDRU5UQUdFOiAwLjcwLFxufTtcblxuLyoqXG4gKiBjYWxsZWQgb24gc3RhcnR1cCBvciB3aGVuIHByZWZzIGNoYW5nZVxuICogUG9wdWxhdGVkIHZpYSBpbml0IGNvbmZpZy5cbiAqIEB0eXBlIHtzdWJzY3JpcHRpb25DYWxsYmFja1tdfSAgLVxuICovXG5jb25zdCBzdWJzY3JpYmVyQ2FsbGJhY2tzID0gW107XG5cbi8qKlxuICogc3Vic2NyaXB0aW9ucyB0byBjYWxsIG9uIHByZWZzIGluaXRcbiAqIEB0eXBlIHtzdGFydHVwQ2FsbGJhY2tbXX0gLVxuICovXG5jb25zdCBzdGFydHVwU3Vic2NyaWJlcnMgPSBbXTtcblxuLyoqXG4gKiBnZXRPcmlnaW4gaXMgYSBjYWxsIGJhY2tcbiAqIHRoYXQgc2hvdWxkIHJldHVybiB0aGUgb3JpZ2luIG9mIHRoZSBwYWdlLlxuICogRGVwZW5kaW5nIG9uIHRoZSBjb250ZXh0LCB3aGV0aGVyIGl0IGJlXG4gKiBwb3B1cCBvciBjb250ZW50IHNjcmlwdCwgdGhleSBtaWdodCBub3RcbiAqIGhhdmUgZGlyZWN0IGFjY2VzcyB0byBvcmlnaW4sIHNvIGxldCB0aGVtIGRlZmluZVxuICogaG93IG9yaWdpbiBzaG91bGQgYmUgcmV0cmVpdmVkXG4gKiBQb3B1bGF0ZWQgdmlhIGluaXQgY29uZmlnLlxuICogQHR5cGUgeygpPT5Qcm9taXNlPHN0cmluZz59IC1cbiAqL1xubGV0IGdldE9yaWdpbjtcblxuLyoqXG4gKiBpbml0IGlzIHRoZSBlbnRyeSBwb2ludCBvZiB0aGUgcHJlZmVyZW5jZVxuICogd2hpY2ggcmV0dXJucyB0aGUgZm9sbG93aW5nOlxuICogLSBzdGFydCgpIHRvIGtpY2tzdGFydCBwcmVmZXJlbmNlXG4gKiAgICByZXRyaWV2YWwgYW5kIGRpc3BhdGNoIHRoYXQgcHJlZmVyZW5jZVxuICogICAgZm9yIHN1YnNjcmliZXJzIHRvIGtub3dcbiAqIC9cbiAqIC0gc2V0UHJlZnMoKSB0byB1cGRhdGUgcHJlZmVyZW5jZXNcbiAqICAgIGFuZCBkaXNwYXRjaCB0aGUgdXBkYXRlcyBmb3IgYWxsXG4gKiAgICBzdWJzY3JpYmVyc1xuICogL1xuICogLSBkZWZhdWx0UHJlZnMoKSAtIGlzIGEgZ2V0dGVyIHRoYXRcbiAqICAgIHJldHVybnMgdGhlIGRlZmF1bHRQcmVmZXJlbmNlc1xuICogQHBhcmFtIHt7XG4gKiBzdWJzY3JpYmU/OiBzdWJzY3JpcHRpb25DYWxsYmFjayAsXG4gKiBvblN0YXJ0dXA/OiBzdGFydHVwQ2FsbGJhY2sgLFxuICogZ2V0T3JpZ2luOiB7KCk9PlByb21pc2U8c3RyaW5nPn1cbiAqIH19IGNvbmZpZ1xuICogQGNhbGxiYWNrIHN1YnNjcmlwdGlvbkNhbGxiYWNrIC0gY2FsbGVkIHdoZW4gcHJlZnMgY2hhbmdlXG4gKiBAcGFyYW0ge1ByZWZzfSBwcmVmc1xuICogQGNhbGxiYWNrIHN0YXJ0dXBDYWxsYmFjayBmaXJlZCBvbiB3aGVuIGluaXQgaXMgY2FsbGVkXG4gKiBAcGFyYW0ge1ByZWZzfSBwcmVmc1xuICogQHR5cGVkZWYge2RlZmF1bHRQcmVmc30gUHJlZnNcbiAqL1xuZnVuY3Rpb24gaW5pdChjb25maWcpIHtcbiAgLy8gY3VycmVudGx5IG9ubHkgaW5pdCBjYW4gYWRkIHRvXG4gIC8vIHN1YnNjcmliZXJzIGJ1dCBpdCBiZSBlYXN5XG4gIC8vIHRvIGV4cG9zZSBhbm90aGVyIGFwaSB0byBhZGRcbiAgLy8gdG8gc3Vic2NyaWJlciBpZiBuZWVkZWRcbiAgaWYgKGNvbmZpZy5zdWJzY3JpYmUpIHtcbiAgICBzdWJzY3JpYmVyQ2FsbGJhY2tzLnB1c2goY29uZmlnLnN1YnNjcmliZSk7XG4gIH1cbiAgaWYgKGNvbmZpZy5vblN0YXJ0dXApIHtcbiAgICBzdGFydHVwU3Vic2NyaWJlcnMucHVzaChjb25maWcub25TdGFydHVwKTtcbiAgfVxuICAvLyBuZWNlc3NhcnkgdG8gZ2V0IHRoZSBvcmlnaW5cbiAgLy8gd2hpY2ggaXMgdXNlZCB0byAnbG9jYWwnIEFLQSBwZXItc2l0ZSBwcmVmc1xuICBnZXRPcmlnaW4gPSBjb25maWcuZ2V0T3JpZ2luO1xuXG4gIHJldHVybiB7XG4gICAgc3RhcnQsXG4gICAgc2V0UHJlZnMsXG4gICAgZ2V0UHJlZnMsXG4gICAgZGVmYXVsdFByZWZzOiAoKSA9PiBkZWZhdWx0UHJlZnMsXG4gIH07XG59XG5cbmNvbnN0IGlzQmFja2dyb3VuZFNjcmlwdCA9ICgpID0+IHtcbiAgaWYgKHR5cGVvZiBjaHJvbWU/LmV4dGVuc2lvbj8uZ2V0QmFja2dyb3VuZFBhZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNjI2NzY2OC9jYW4tanMtY29kZS1pbi1jaHJvbWUtZXh0ZW5zaW9uLWRldGVjdC10aGF0LWl0cy1leGVjdXRlZC1hcy1jb250ZW50LXNjcmlwdFxuICAgIC8vIGRldGVjdCB3aGVyZSBjb2RlIGlzIHJ1bm5pbmcgZnJvbSwgaXMgaXQgY29udGVudCBzY3JpcHQsIHBvcHVwIG9yIGJhY2tncm91bmQ/XG4gICAgLy8gdGhhdHMgaW1wb3J0YW50IHRvIGtub3cgaWYgYWxsIDMgY29udGV4dCBjYWxsIHRoZSBzYW1lIGZ1bmN0aW9ucywgdGhhdCBzaGFyZWQgZnVuY3Rpb24gaGFzXG4gICAgLy8gdG8ga25vdyB0aGUgY29udGV4dCBzbyBpdCBjYW4gd29yayBwcm9wZXJseSBiYXNlZCBvbiB0aGUgY29udGV4dFxuXG4gICAgLy8gd2Uga25vdyB3ZSBhcmUgb24gYmFja2dyb3VuZCBzY3JpcHQgaWYgZ2V0QmFja2dyb3VuZFBhZ2UgPT09IHdpbmRvd1xuICAgIHJldHVybiBjaHJvbWUuZXh0ZW5zaW9uLmdldEJhY2tncm91bmRQYWdlKCkgPT09IHdpbmRvdztcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59O1xuXG4vKiogQHJldHVybnMge1Byb21pc2U8UHJlZnNbXT58UHJvbWlzZTxQcmVmcz59ICovXG5hc3luYyBmdW5jdGlvbiByZXRyaWV2ZVByZWZzRnJvbVN0b3JhZ2UoLyoqIEB0eXBlIHtzdHJpbmd9ICdsb2NhbCd8J2dsb2JhbCcgKi8gYWN0aW9uKSB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgaWYgKGlzQmFja2dyb3VuZFNjcmlwdCgpKSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IFN0b3JhZ2VIZWxwZXIucmV0cmlldmVQcmVmcyhhY3Rpb24pO1xuICAgICAgcmVzb2x2ZShyZXNwb25zZT8uZGF0YSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHsgbWVzc2FnZTogJ3JldHJpZXZlUHJlZnMnLCBhY3Rpb24gfSwgYXN5bmMgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIHJlc29sdmUocmVzcG9uc2U/LmRhdGEpO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gc3RvcmVQcmVmc0luU3RvcmFnZShcbiAgLyoqIEB0eXBlIHtQcmVmc30gKi8gcHJlZnMsXG4gIC8qKiBAdHlwZSB7c3RyaW5nfSAnZ2xvYmFsJ3wnbG9jYWwnICovIGFjdGlvbixcbikge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGlmIChpc0JhY2tncm91bmRTY3JpcHQoKSkge1xuICAgICAgU3RvcmFnZUhlbHBlci5zdG9yZVByZWZzKGFjdGlvbiwgcHJlZnMpO1xuICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hyb21lLnJ1bnRpbWUuc2VuZE1lc3NhZ2UoeyBtZXNzYWdlOiAnc3RvcmVQcmVmcycsIGRhdGE6IHByZWZzLCBhY3Rpb24gfSwgYXN5bmMgKF8pID0+IHtcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKiBAcmV0dXJucyB7UHJvbWlzZTxQcmVmc1tdPn0gKi9cbmFzeW5jIGZ1bmN0aW9uIHJldHJpZXZlTG9jYWxQcmVmcygpIHtcbiAgcmV0dXJuIHJldHJpZXZlUHJlZnNGcm9tU3RvcmFnZSgnbG9jYWwnKTtcbn1cblxuLyoqIEByZXR1cm4ge1Byb21pc2U8UHJlZnNbXT59ICovXG5hc3luYyBmdW5jdGlvbiByZXRyaXZlR2xvYmFsUHJlZnMoKSB7XG4gIHJldHVybiByZXRyaWV2ZVByZWZzRnJvbVN0b3JhZ2UoJ2dsb2JhbCcpO1xufVxuXG4vLyBTdG9yZXMgbG9jYWwgcHJlZmVyZW5jZXMgaW50byBzdG9yYWdlXG5hc3luYyBmdW5jdGlvbiBzdG9yZUxvY2FsUHJlZnMocHJlZnMpIHtcbiAgcmV0dXJuIHN0b3JlUHJlZnNJblN0b3JhZ2UocHJlZnMsICdsb2NhbCcpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzdG9yZUdsb2JhbFByZWZzKHByZWZzKSB7XG4gIHJldHVybiBzdG9yZVByZWZzSW5TdG9yYWdlKHByZWZzLCAnZ2xvYmFsJyk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgcHJlZnMgZm9yIHRoZSBvZ2lyaW4gaWYgYXZhaWxhYmxlIGVsc2UgcmV0dXJucyBnbG9iYWwgcHJlZnNcbiAqIEByZXR1cm5zIHtQcm9taXNlPFByZWZzPn1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0UHJlZnMoKSB7XG4gIHJldHVybiB7IC4uLigoYXdhaXQgcmV0cmlldmVMb2NhbFByZWZzKCkpW2F3YWl0IGdldE9yaWdpbigpXSA/PyAoYXdhaXQgcmV0cml2ZUdsb2JhbFByZWZzKCkpKSB9O1xufVxuXG4vKipcbiAqIHNldFByZWZzIHVwZGF0ZXMgdGhlIHByZWZlcmVuY2VzIGluIHN0b3JhZ2VcbiAqIGFuZCBkaXNwYXRjaCB0aGlzIHVwZGF0ZSB0byBhbGwgc3Vic2NyaWJlcnNcbiAqIHByZWZzIC0gaGFzIHRoZSBzaGFwZSBvZiBkZWZhdWx0UHJlZnNcbiAqIG9yIGEgY2FsbCBiYWNrIHRoYXQgcmV0dXJucyB0aGF0IHNoYXBlXG4gKiBidXQgeW91IG9ubHkgbmVlZCB0byBwYXNzIHRoZSBhY3R1YWwgZmllbGRzXG4gKiB5b3Ugd2FudCB0byB1cGRhdGUuXG4gKlxuICovXG5hc3luYyBmdW5jdGlvbiBzZXRQcmVmcygvKiogQHR5cGUgeyhwcmVmczpQcmVmcyk9Pnt9fFByZWZzfSAqLyBwcmVmcykge1xuICAvLyBncmFiIHRoZSBjdXJyZW50IHByZWZzXG4gIGNvbnN0IGxvY2FsUHJlZnMgPSBhd2FpdCByZXRyaWV2ZUxvY2FsUHJlZnMoKTtcbiAgbGV0IGdsb2JhbFByZWZzID0gYXdhaXQgcmV0cml2ZUdsb2JhbFByZWZzKCk7XG4gIGNvbnN0IG9yaWdpbiA9IGF3YWl0IGdldE9yaWdpbigpO1xuXG4gIC8vIGlmIGxvY2FsXG4gIGNvbnN0IGN1cnJlbnRQcmVmcyA9IHtcbiAgICAuLi4obG9jYWxQcmVmc1tvcmlnaW5dPy5zY29wZSA9PT0gJ2xvY2FsJyA/IGxvY2FsUHJlZnNbb3JpZ2luXSA6IGdsb2JhbFByZWZzKSxcbiAgfTtcblxuICAvLyBpZiBwcmVmcyBpcyBhIGZ1bmN0aW9uLCBwYXNzIGluIHRoZSBjdXJyZW50XG4gIC8vIHByZWZzIGJhc2VkIG9uIHRoZSBzY29wZVxuICAvLyBhbmQgbmV3UHJlZnMgd2lsbCBiZSB0aGUgcmV0dXJuIHZhbCBvZiB0aGUgZnVuY3Rpb25cbiAgLy8gb3RoZXJ3aXNlIHRoZSBuZXdQcmVmcyB3aWxsIGp1c3QgYmUgdGhlIHByZWZzXG5cbiAgY29uc3QgbmV3UHJlZnMgPSB7XG4gICAgLi4uY3VycmVudFByZWZzLFxuICAgIC4uLih0eXBlb2YgcHJlZnMgPT09ICdmdW5jdGlvbicgPyBwcmVmcyhjdXJyZW50UHJlZnMpIDogcHJlZnMpLFxuICB9O1xuXG4gIGlmIChuZXdQcmVmcy5zY29wZSA9PT0gJ2dsb2JhbCcpIHtcbiAgICAvLyB3cml0ZSBzY29wZSB0byBnbG9iYWwgcHJlZnNcbiAgICBnbG9iYWxQcmVmcyA9IHtcbiAgICAgIC4uLmdsb2JhbFByZWZzLFxuICAgICAgLy8gd3JpdGUgZ2xvYmFsUHJlZnMgb25seSBpZiBsb2NhbFByZWZzW29yaWdpbl0gaGFzIGJlZW4gcmVtb3ZlZCBwcmlvclxuICAgICAgLi4uKCFsb2NhbFByZWZzW29yaWdpbl0gPyBuZXdQcmVmcyA6IG51bGwpLFxuICAgICAgc2NvcGU6IG5ld1ByZWZzLnNjb3BlLFxuICAgIH07XG5cbiAgICBpZiAobG9jYWxQcmVmc1tvcmlnaW5dKSBkZWxldGUgbG9jYWxQcmVmc1tvcmlnaW5dO1xuICB9IGVsc2Uge1xuICAgIGxvY2FsUHJlZnNbb3JpZ2luXSA9IHsgLi4ubG9jYWxQcmVmc1tvcmlnaW5dLCAuLi5uZXdQcmVmcyB9O1xuICB9XG5cbiAgZGlzcGF0Y2hQcmVmc1VwZGF0ZShsb2NhbFByZWZzW29yaWdpbl0gPz8gZ2xvYmFsUHJlZnMpO1xuXG4gIHN0b3JlTG9jYWxQcmVmcyhsb2NhbFByZWZzKTtcbiAgc3RvcmVHbG9iYWxQcmVmcyhnbG9iYWxQcmVmcyk7XG59XG5cbi8qKlxuICogc3RhcnQgLSBraWNrc3RhcnRzIHRoZSByZXRyaWV2YWwgb2YgdGhlIGN1cnJlbnQgcHJlZmVyZW5jZVxuICogYW5kIGRpc3BhdGNoIHRoYXQgcHJlZnMgdG8gc3Vic2NyaWJlcnNcbiAqIGZvciBleGFtcGxlIHVzYWdlLCBzZWUgUHJlZmVyZW5jZS5pbml0IG9uXG4gKiBQb3B1cC9pbmRleC5qcyBhbmQgQ29udGVudFNjcmlwdC9pbmRleC5qc1xuICovXG5hc3luYyBmdW5jdGlvbiBzdGFydCgpIHtcbiAgbGV0IGxvY2FsUHJlZnMgPSBhd2FpdCByZXRyaWV2ZUxvY2FsUHJlZnMoKTtcbiAgbGV0IGdsb2JhbFByZWZzID0gYXdhaXQgcmV0cml2ZUdsb2JhbFByZWZzKCk7XG4gIGNvbnN0IG9yaWdpbiA9IGF3YWl0IGdldE9yaWdpbigpO1xuXG4gIGlmIChsb2NhbFByZWZzID09IG51bGwpIHtcbiAgICBsb2NhbFByZWZzID0ge307XG4gIH1cblxuICAvLyBqdXN0IGluIGNhc2UgdGhlaXIgbWlzc2luZyBhIGRlZmF1bHQgcHJlZnNcbiAgLy8gYmUgc3VyZSB0byBwZXBwZXIgdGhlIGRlZmF1bHQgcHJlZnNcbiAgLy8gbG9jYWxQcmVmc1tvcmlnaW5dID0geyAuLi5kZWZhdWx0UHJlZnMsIC4uLmxvY2FsUHJlZnNbb3JpZ2luXSB9O1xuICBnbG9iYWxQcmVmcyA9IHsgLi4uZGVmYXVsdFByZWZzLCAuLi5nbG9iYWxQcmVmcyB9O1xuXG4gIHN0b3JlTG9jYWxQcmVmcyhsb2NhbFByZWZzKTtcbiAgc3RvcmVHbG9iYWxQcmVmcyhnbG9iYWxQcmVmcyk7XG5cbiAgaWYgKGxvY2FsUHJlZnNbb3JpZ2luXT8uc2NvcGUgPT09ICdsb2NhbCcpIHtcbiAgICBkaXNwYXRjaFByZWZzVXBkYXRlKGxvY2FsUHJlZnNbb3JpZ2luXSk7XG4gICAgZGlzcGF0Y2hQcmVmc1VwZGF0ZShsb2NhbFByZWZzW29yaWdpbl0sIHN0YXJ0dXBTdWJzY3JpYmVycyk7XG4gIH0gZWxzZSB7XG4gICAgZGlzcGF0Y2hQcmVmc1VwZGF0ZShnbG9iYWxQcmVmcyk7XG4gICAgZGlzcGF0Y2hQcmVmc1VwZGF0ZShnbG9iYWxQcmVmcywgc3RhcnR1cFN1YnNjcmliZXJzKTtcbiAgfVxufVxuXG4vKipcbiAqIGNhbGxzIGFsbCBzdWJzY3JpYmVyIGNhbGwgYmFja1xuICogYW5kIHBhc3MgdGhlbSB0aGUgcHJlZmVyZW5jZSB2aWEgcHJlZnNcbiAqIHBhcmFtc1xuICovXG5mdW5jdGlvbiBkaXNwYXRjaFByZWZzVXBkYXRlKC8qKiBAdHlwZSBQcmVmcyAqLyBwcmVmcywgLyoqIEB0eXBlIHtGdW5jdGlvbltdfSAqLyBjYnMpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkoY2JzKSkge1xuICAgIGNicy5mb3JFYWNoKChjYikgPT4ge1xuICAgICAgY2IocHJlZnMpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHN1YnNjcmliZXJDYWxsYmFja3MuZm9yRWFjaCgoY2IpID0+IHtcbiAgICAgIGNiKHByZWZzKTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGluaXQsXG59O1xuIiwiaW1wb3J0IFRhYkhlbHBlciBmcm9tICcuLi9UYWJIZWxwZXInO1xuaW1wb3J0IExvZ2dlciBmcm9tICcuLi9Mb2dnZXInO1xuaW1wb3J0IFByZWZlcmVuY2VzIGZyb20gJy4uL1ByZWZlcmVuY2VzJztcbmltcG9ydCBTdG9yYWdlSGVscGVyIGZyb20gJy4uL1N0b3JhZ2VIZWxwZXInO1xuXG5jb25zdCBydW5UaW1lSGFuZGxlciA9IHR5cGVvZiBicm93c2VyID09PSAndW5kZWZpbmVkJyA/IGNocm9tZSA6IGJyb3dzZXI7XG5cbmNvbnN0IHsgZ2V0UHJlZnMsIGRlZmF1bHRQcmVmcyB9ID0gUHJlZmVyZW5jZXMuaW5pdCh7XG4gIGdldE9yaWdpbjogYXN5bmMgKCkgPT4gVGFiSGVscGVyLmdldFRhYk9yaWdpbigpLFxufSk7XG5cbmNvbnN0IGxpc3RlbmVyID0gKHJlcXVlc3QsIHNlbmRlciwgc2VuZFJlc3BvbnNlKSA9PiB7XG4gIHN3aXRjaCAocmVxdWVzdC5tZXNzYWdlKSB7XG4gICAgY2FzZSAnc3RvcmVQcmVmcyc6IHtcbiAgICAgIHNlbmRSZXNwb25zZShTdG9yYWdlSGVscGVyLnN0b3JlUHJlZnMocmVxdWVzdC5hY3Rpb24sIHJlcXVlc3QuZGF0YSkpO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgJ3JldHJpZXZlUHJlZnMnOiB7XG4gICAgICBzZW5kUmVzcG9uc2UoU3RvcmFnZUhlbHBlci5yZXRyaWV2ZVByZWZzKHJlcXVlc3QuYWN0aW9uKSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSAnc2V0SWNvbkJhZGdlVGV4dCc6IHtcbiAgICAgIFRhYkhlbHBlci5nZXRBY3RpdmVUYWIoKS50aGVuKCh0YWIpID0+IHtcbiAgICAgICAgY2hyb21lLmJyb3dzZXJBY3Rpb24uc2V0QmFkZ2VUZXh0KHsgdGV4dDogcmVxdWVzdC5kYXRhID8gJ09uJyA6ICdPZmYnLCB0YWJJZDogdGFiLmlkIH0pO1xuICAgICAgICBzZW5kUmVzcG9uc2UodHJ1ZSk7XG4gICAgICB9KTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBkZWZhdWx0OlxuICAgICAgc2VuZFJlc3BvbnNlKGZhbHNlKTtcbiAgICAgIGJyZWFrO1xuICB9XG59O1xuXG5jb25zdCBjb21tYW5kTGlzdGVuZXIgPSBhc3luYyAoY29tbWFuZCkgPT4ge1xuICBMb2dnZXIubG9nSW5mbygnY29tbW1hbmQgZmlyZWQnLCBjb21tYW5kKTtcblxuICBpZiAoY29tbWFuZCA9PT0gJ3RvZ2dsZS1iaW9uaWMnKSB7XG4gICAgY29uc3QgYWN0aXZlVGFiID0gYXdhaXQgVGFiSGVscGVyLmdldEFjdGl2ZVRhYigpO1xuXG4gICAgY29uc3QgW3sgZGF0YTogdGFiQnJNb2RlIH0sIGdldFJlYWRpbmdNb2RlRXJyb3JdID0gYXdhaXQgbmV3IFByb21pc2UoKHJlcywgXykgPT4ge1xuICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UoYWN0aXZlVGFiLmlkLCB7IHR5cGU6ICdnZXRSZWFkaW5nTW9kZScgfSwgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIExvZ2dlci5sb2dJbmZvKHsgYWN0aXZlVGFiLCByZXNwb25zZSB9KTtcbiAgICAgICAgcmVzKFtyZXNwb25zZSwgY2hyb21lLnJ1bnRpbWU/Lmxhc3RFcnJvcl0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpZiAoZ2V0UmVhZGluZ01vZGVFcnJvcikgdGhyb3cgTG9nZ2VyLmxvZ0Vycm9yKGdldFJlYWRpbmdNb2RlRXJyb3IpO1xuXG4gICAgLy8gc2V0IHByZWZzIHRvIGdsb2JhbCBpZiBsb2NhbCBpcyBub3QgcHJlc2VudCBvciBsb2NhbFtzY29wZV0gPT0gJ2dsb2JhbCdcbiAgICBjb25zdCBwcmVmcyA9IGF3YWl0IGdldFByZWZzKCk7XG5cbiAgICBjb25zdCBpbnRlbnRlZFRhYkJyTW9kZSA9ICF0YWJCck1vZGU7XG4gICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UoYWN0aXZlVGFiLmlkLCB7IHR5cGU6ICdzZXRSZWFkaW5nTW9kZScsIGRhdGE6IGludGVudGVkVGFiQnJNb2RlIH0sICgpID0+IExvZ2dlci5Mb2dMYXN0RXJyb3IoKSk7XG5cbiAgICBpZiAoaW50ZW50ZWRUYWJCck1vZGUpIHtcbiAgICAgIExvZ2dlci5sb2dJbmZvKHByZWZzKTtcblxuICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGFjdGl2ZVRhYi5pZCxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdzZXRTYWNjYWRlc0ludGVydmFsSW5ET00nLFxuICAgICAgICAgIGRhdGE6IHByZWZzLnNhY2NhZGVzSW50ZXJ2YWwsXG4gICAgICAgIH0sXG4gICAgICAgICgpID0+IExvZ2dlci5Mb2dMYXN0RXJyb3IoKSxcbiAgICAgICk7XG4gICAgICBjaHJvbWUudGFicy5zZW5kTWVzc2FnZShhY3RpdmVUYWIuaWQsIHsgdHlwZTogJ3NldExpbmVIZWlnaHQnLCBkYXRhOiBwcmVmcy5saW5lSGVpZ2h0IH0pO1xuICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGFjdGl2ZVRhYi5pZCxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdzZXRGaXhhdGlvblN0cmVuZ3RoJyxcbiAgICAgICAgICBkYXRhOiBwcmVmcy5maXhhdGlvblN0cmVuZ3RoLFxuICAgICAgICB9LFxuICAgICAgICAoKSA9PiBMb2dnZXIuTG9nTGFzdEVycm9yKCksXG4gICAgICApO1xuICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGFjdGl2ZVRhYi5pZCxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdzZXRGaXhhdGlvbkVkZ2VPcGFjaXR5JyxcbiAgICAgICAgICBkYXRhOiBwcmVmcy5maXhhdGlvbkVkZ2VPcGFjaXR5LFxuICAgICAgICB9LFxuICAgICAgICAoKSA9PiBMb2dnZXIuTG9nTGFzdEVycm9yKCksXG4gICAgICApO1xuICAgICAgY2hyb21lLnRhYnMuc2VuZE1lc3NhZ2UoXG4gICAgICAgIGFjdGl2ZVRhYi5pZCxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdzZXRTYWNjYWRlc1N0eWxlJyxcbiAgICAgICAgICBkYXRhOiBwcmVmcy5zYWNjYWRlc1N0eWxlLFxuICAgICAgICB9LFxuICAgICAgICAoKSA9PiBMb2dnZXIuTG9nTGFzdEVycm9yKCksXG4gICAgICApO1xuICAgIH1cbiAgfVxufTtcblxuY2hyb21lLnJ1bnRpbWUub25JbnN0YWxsZWQuYWRkTGlzdGVuZXIoXG4gIChldmVudCkgPT4ge1xuICAgIExvZ2dlci5sb2dJbmZvKCdpbnN0YWxsIHN1Y2Nlc3MnLCBldmVudC5yZWFzb24pO1xuXG4gICAgaWYgKGV2ZW50LnJlYXNvbiA9PT0gJ2luc3RhbGwnIHx8IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHsgY2hyb21lLnRhYnMuY3JlYXRlKHsgYWN0aXZlOiB0cnVlLCB1cmw6ICdodHRwczovL2dpdGh1Yi5jb20vYW5zaC9qaWZmeXJlYWRlci5jb20jRkFRJyB9KTsgfVxuICB9LFxuKTtcblxuY2hyb21lLmNvbW1hbmRzLm9uQ29tbWFuZC5hZGRMaXN0ZW5lcihjb21tYW5kTGlzdGVuZXIpO1xuXG5ydW5UaW1lSGFuZGxlci5ydW50aW1lLm9uTWVzc2FnZS5hZGRMaXN0ZW5lcihsaXN0ZW5lcik7XG4iXSwibmFtZXMiOlsibG9nSW5mbyIsInByb2Nlc3MiLCJjb25zb2xlIiwibG9nIiwibG9nRXJyb3IiLCJpc1Byb2R1Y3Rpb24iLCJlcnJvciIsIm1ha2VFcnJvciIsImxvZ1RpbWUiLCJsYWJlbCIsIkxvZ0xhc3RFcnJvciIsImxhc3RFcnJvciIsImNocm9tZSIsInJ1bnRpbWUiLCJnZXRBY3RpdmVUYWIiLCJQcm9taXNlIiwicmVzIiwiXyIsInRhYnMiLCJxdWVyeSIsImFjdGl2ZSIsImN1cnJlbnRXaW5kb3ciLCJhY3RpdmVUYWIiLCJMb2dnZXIiLCJhc3luYyIsInRlbXBUYWIiLCJ0YWIiLCJzZW5kTWVzc2FnZSIsImlkIiwidHlwZSIsImRhdGEiLCJvcmlnaW5FcnJvciIsInN0b3JlUHJlZnMiLCJhY3Rpb24iLCJrZXkiLCJwcmVmc0pTT05TdHIiLCJKU09OIiwic3RyaW5naWZ5IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsInN1Y2Nlc3MiLCJlcnIiLCJyZXRyaWV2ZVByZWZzIiwiZ2V0SXRlbSIsInBhcnNlIiwiZGVmYXVsdFByZWZzIiwib25QYWdlTG9hZCIsInNjb3BlIiwibGluZUhlaWdodCIsImVkZ2VPcGFjaXR5Iiwic2FjY2FkZXNDb2xvciIsInNhY2NhZGVzU3R5bGUiLCJzYWNjYWRlc0ludGVydmFsIiwiZml4YXRpb25TdHJlbmd0aCIsImZpeGF0aW9uRWRnZU9wYWNpdHkiLCJNQVhfRklYQVRJT05fUEFSVFMiLCJGSVhBVElPTl9MT1dFUl9CT1VORCIsIkJSX1dPUkRfU1RFTV9QRVJDRU5UQUdFIiwic3Vic2NyaWJlckNhbGxiYWNrcyIsInN0YXJ0dXBTdWJzY3JpYmVycyIsImdldE9yaWdpbiIsImlzQmFja2dyb3VuZFNjcmlwdCIsImV4dGVuc2lvbiIsImdldEJhY2tncm91bmRQYWdlIiwid2luZG93IiwicmV0cmlldmVQcmVmc0Zyb21TdG9yYWdlIiwicmVzb2x2ZSIsInJlamVjdCIsInJlc3BvbnNlIiwiU3RvcmFnZUhlbHBlciIsIm1lc3NhZ2UiLCJzdG9yZVByZWZzSW5TdG9yYWdlIiwicHJlZnMiLCJyZXRyaWV2ZUxvY2FsUHJlZnMiLCJyZXRyaXZlR2xvYmFsUHJlZnMiLCJzdG9yZUxvY2FsUHJlZnMiLCJzdG9yZUdsb2JhbFByZWZzIiwiZ2V0UHJlZnMiLCJzZXRQcmVmcyIsImxvY2FsUHJlZnMiLCJnbG9iYWxQcmVmcyIsIm9yaWdpbiIsImN1cnJlbnRQcmVmcyIsIm5ld1ByZWZzIiwiZGlzcGF0Y2hQcmVmc1VwZGF0ZSIsInN0YXJ0IiwiY2JzIiwiQXJyYXkiLCJpc0FycmF5IiwiZm9yRWFjaCIsImNiIiwiaW5pdCIsImNvbmZpZyIsInN1YnNjcmliZSIsInB1c2giLCJvblN0YXJ0dXAiLCJydW5UaW1lSGFuZGxlciIsImJyb3dzZXIiLCJQcmVmZXJlbmNlcyIsIlRhYkhlbHBlciIsIm9uSW5zdGFsbGVkIiwiYWRkTGlzdGVuZXIiLCJldmVudCIsInJlYXNvbiIsImNyZWF0ZSIsInVybCIsImNvbW1hbmRzIiwib25Db21tYW5kIiwiY29tbWFuZCIsInRhYkJyTW9kZSIsImdldFJlYWRpbmdNb2RlRXJyb3IiLCJpbnRlbnRlZFRhYkJyTW9kZSIsIm9uTWVzc2FnZSIsInJlcXVlc3QiLCJzZW5kZXIiLCJzZW5kUmVzcG9uc2UiLCJ0aGVuIiwiYnJvd3NlckFjdGlvbiIsInNldEJhZGdlVGV4dCIsInRleHQiLCJ0YWJJZCJdLCJzb3VyY2VSb290IjoiIn0=